<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ü—Ä–æ—Å–ª—É—à–∫–∞ –∑–≤–æ–Ω–∫–æ–≤ + Google Sheets</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { font-family: Arial,sans-serif; margin:20px; background:#f7f7f7; color:#111; }
  h1,h2 { margin:0 0 12px 0; }
  .container { background:#fff; padding:16px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.06); margin-bottom:16px; }
  input,textarea,select { width:100%; padding:8px; margin-top:6px; box-sizing:border-box; border:1px solid #d0d0d0; border-radius:4px; }
  textarea { min-height:60px; resize:vertical; }
  button { padding:6px 12px; margin-top:8px; cursor:pointer; border-radius:6px; border:1px solid #bbb; background:#f6f6f6; }
  button.primary { background:#2b8aef; color:white; border-color:#2577d4; }
  button.danger { background:#ffdddd; border-color:#ff8a8a; }
  .small { padding:4px 8px; font-size:13px; }
  table { width:100%; border-collapse:collapse; margin-top:12px; font-size:14px; }
  th,td { border:1px solid #e0e0e0; padding:8px; text-align:left; vertical-align:top; }
  th { background:#f0f0f0; font-weight:600; }
  .muted { color:#666; font-size:13px; }
  .hidden { display:none; }
  .controls { display:flex; gap:8px; align-items:center; margin-top:8px; }
  .status { margin-top:6px; font-size:13px; }
</style>
</head>
<body>

<div class="container">
  <h1>–§–æ—Ä–º–∞ –≤–Ω–µ—Å–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</h1>
  <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label><input type="text" id="eventName">
  <label>–¶–ê:</label><input type="text" id="targetAudience">
  <label>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞:</label><textarea id="growthZones"></textarea>
  <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label><textarea id="comment"></textarea>
  <label>–£—á–∞—Å—Ç–Ω–∏–∫:</label><input type="text" id="participant">

  <div class="controls">
    <button id="saveBtn" class="primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button id="updateBtn" class="primary hidden">–û–±–Ω–æ–≤–∏—Ç—å</button>
    <button id="cancelBtn" class="small hidden">–û—Ç–º–µ–Ω–∞</button>
  </div>

  <div class="muted">–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage).</div>
  <div id="status" class="status"></div>
</div>

<div class="container">
  <h2>–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h2>
  <table id="mainTable">
    <thead>
      <tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¶–ê</th><th>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th><th>–£—á–∞—Å—Ç–Ω–∏–∫</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="container">
  <h2>–ê—Ä—Ö–∏–≤ –ø–æ –¥–∞—Ç–µ</h2>
  <div style="display:flex; gap:8px; align-items:center;">
    <button id="prevDateBtn" class="small">‚¨Ö</button>
    <input type="date" id="archiveDate">
    <button id="nextDateBtn" class="small">‚û°</button>
    <button id="uploadSheetsBtn" style="margin-left:auto;">üì§ –í—ã–≥—Ä—É–∑–∏—Ç—å –≤ Google Sheets</button>
  </div>
  <table id="archiveTable">
    <thead>
      <tr><th>–î–∞—Ç–∞</th><th>–í—Ä–µ–º—è</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¶–ê</th><th>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th><th>–£—á–∞—Å—Ç–Ω–∏–∫</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const APPS_SCRIPT_URL='–í–°–¢–ê–í–¨–¢–ï_–°–Æ–î–ê_–í–ê–®_URL_WEB_APP';

let editIndex = null;

// helpers
function getRecords(){ return JSON.parse(localStorage.getItem('records')||'[]'); }
function setRecords(arr){ localStorage.setItem('records',JSON.stringify(arr)); }
function escapeHtml(s){ return s?String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;') : ''; }
function escapeCsv(s){ return s==null?'':String(s).replace(/"/g,'""'); }

// CRUD
function saveRecord(){
  const name=document.getElementById('eventName').value.trim();
  const participant=document.getElementById('participant').value.trim();
  if(!name||!participant){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞'); return; }
  const record={date:new Date().toISOString().split('T')[0],time:new Date().toLocaleTimeString(),
    eventName:name,targetAudience:document.getElementById('targetAudience').value.trim(),
    growthZones:document.getElementById('growthZones').value.trim(),
    comment:document.getElementById('comment').value.trim(),participant
  };
  const records=getRecords(); records.push(record); setRecords(records);
  clearForm(); refreshAll(); showSaveMode();
}
function updateRecord(){ if(editIndex===null) return; const records=getRecords(); if(!records[editIndex]) return; 
records[editIndex].eventName=document.getElementById('eventName').value.trim();
records[editIndex].targetAudience=document.getElementById('targetAudience').value.trim();
records[editIndex].growthZones=document.getElementById('growthZones').value.trim();
records[editIndex].comment=document.getElementById('comment').value.trim();
records[editIndex].participant=document.getElementById('participant').value.trim();
setRecords(records); clearForm(); refreshAll(); showSaveMode(); }
function clearForm(){ document.getElementById('eventName').value=''; document.getElementById('targetAudience').value=''; document.getElementById('growthZones').value=''; document.getElementById('comment').value=''; document.getElementById('participant').value=''; editIndex=null; }

// UI
function showSaveMode(){ document.getElementById('saveBtn').classList.remove('hidden'); document.getElementById('updateBtn').classList.add('hidden'); document.getElementById('cancelBtn').classList.add('hidden'); editIndex=null; }
function showEditMode(){ document.getElementById('saveBtn').classList.add('hidden'); document.getElementById('updateBtn').classList.remove('hidden'); document.getElementById('cancelBtn').classList.remove('hidden'); }

// Table rendering
function refreshAll(){ renderMainTable(); updateArchiveDate(); renderArchiveTable(); }
function renderMainTable(){ const records=getRecords(); const body=document.querySelector('#mainTable tbody'); body.innerHTML=''; if(!records.length){ body.innerHTML='<tr><td colspan="6" class="muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</td></tr>'; return; } records.forEach((r,i)=>{ body.innerHTML+=`<tr>
<td>${escapeHtml(r.eventName)}</td>
<td>${escapeHtml(r.targetAudience||'')}</td>
<td>${escapeHtml(r.growthZones||'')}</td>
<td>${escapeHtml(r.comment||'')}</td>
<td>${escapeHtml(r.participant||'')}</td>
<td>
<button class="small" onclick="editRecord(${i})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
<button class="small danger" onclick="deleteRecord(${i})">–£–¥–∞–ª–∏—Ç—å</button>
</td>
</tr>`});}
function editRecord(i){ const r=getRecords()[i]; document.getElementById('eventName').value=r.eventName; document.getElementById('targetAudience').value=r.targetAudience||''; document.getElementById('growthZones').value=r.growthZones||''; document.getElementById('comment').value=r.comment||''; document.getElementById('participant').value=r.participant||''; editIndex=i; showEditMode(); }
function deleteRecord(i){ if(!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return; const records=getRecords(); records.splice(i,1); setRecords(records); clearForm(); showSaveMode(); refreshAll(); }

// Archive
const archiveInput=document.getElementById('archiveDate');
function updateArchiveDate(){ const records=getRecords(); const dates=[...new Set(records.map(r=>r.date))].sort(); archiveInput.value=dates[dates.length-1]||new Date().toISOString().split('T')[0]; renderArchiveTable(); }
function renderArchiveTable(){ const records=getRecords(); const chosen=archiveInput.value; const body=document.querySelector('#archiveTable tbody'); body.innerHTML=''; if(!chosen){ body.innerHTML='<tr><td colspan="7" class="muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</td></tr>'; return; } const filtered=records.filter(r=>r.date===chosen); if(!filtered.length){ body.innerHTML='<tr><td colspan="7" class="muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å</td></tr>'; return; } filtered.forEach(r=>{ body.innerHTML+=`<tr>
<td>${escapeHtml(r.date)}</td>
<td>${escapeHtml(r.time||'')}</td>
<td>${escapeHtml(r.eventName)}</td>
<td>${escapeHtml(r.targetAudience||'')}</td>
<td>${escapeHtml(r.growthZones||'')}</td>
<td>${escapeHtml(r.comment||'')}</td>
<td>${escapeHtml(r.participant||'')}</td>
</tr>`}); }
function prevDate(){ const opt=archiveInput; if(opt.selectedIndex>0){ const dates=[...new Set(getRecords().map(r=>r.date))].sort(); let cur=dates.indexOf(opt.value); if(cur>0) opt.value=dates[cur-1]; renderArchiveTable();} }
function nextDate(){ const opt=archiveInput; const dates=[...new Set(getRecords().map(r=>r.date))].sort(); let cur=dates.indexOf(opt.value); if(cur<dates.length-1) opt.value=dates[cur+1]; renderArchiveTable();}

// Upload to Google Sheets
function uploadSheets(){
  const records=getRecords();
  if(!records.length){ alert('–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏'); return; }
  document.getElementById('status').textContent='–í—ã–≥—Ä—É–∑–∫–∞...';
  fetch(APPS_SCRIPT_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(records)
  })
  .then(res=>res.json())
  .then(r=>{
    if(r.status==='ok'){ document.getElementById('status').textContent='–í—ã–≥—Ä—É–∑–∫–∞ —É—Å–ø–µ—à–Ω–∞!'; } 
    else { document.getElementById('status').textContent='–û—à–∏–±–∫–∞: '+(r.message||''); }
  })
  .catch(err=>{
    console.error(err);
    document.getElementById('status').textContent='–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ: '+err.message;
  });
}

// Event listeners
document.getElementById('saveBtn').addEventListener('click',saveRecord);
document.getElementById('updateBtn').addEventListener('click',updateRecord);
document.getElementById('cancelBtn').addEventListener('click',()=>{clearForm();showSaveMode();});
archiveInput.addEventListener('change',renderArchiveTable);
document.getElementById('uploadSheetsBtn').addEventListener('click',uploadSheets);

// Init
window.addEventListener('load',()=>{refreshAll(); showSaveMode();});
</script>

</body>
</html>







