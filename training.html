<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ—Å–ª—É—à–∫–∞ –∑–≤–æ–Ω–∫–æ–≤</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f7f7f7; }
    h2 { margin-top: 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; vertical-align: top; }
    th { background: #eaeaea; }
    input, textarea, select { width: 100%; padding: 6px; margin: 4px 0; }
    button { padding: 6px 12px; margin-top: 5px; cursor: pointer; }
    .container { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }

    /* —Å–µ—Ç–∫–∞ */
    .grid { display: flex; gap: 20px; }
    .form-section { flex: 1; }
    .table-section { flex: 2; }

    .spoiler { margin-top: 10px; }
    .spoiler button { margin-bottom: 8px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<div class="grid">
  <!-- –§–æ—Ä–º–∞ -->
  <div class="container form-section">
    <h1>–§–æ—Ä–º–∞ –≤–Ω–µ—Å–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</h1>
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—É—á–∞—é—â–µ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</label>
    <input type="text" id="eventName">

    <label>–¶–ê:</label>
    <input type="text" id="targetAudience">

    <label>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞:</label>
    <textarea id="growthZones"></textarea>

    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
    <textarea id="comment"></textarea>

    <label>–£—á–∞—Å—Ç–Ω–∏–∫:</label>
    <input type="text" id="participant">

    <button onclick="saveData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
  <div class="container table-section">
    <h2>–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h2>
    <table id="mainTable">
      <thead>
        <tr>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–¶–ê</th>
          <th>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</th>
          <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
          <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
          <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="spoiler">
      <button onclick="toggleSpoiler()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏</button>
      <table id="spoilerTable" class="hidden">
        <thead>
          <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–¶–ê</th>
            <th>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
            <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<!-- –ê—Ä—Ö–∏–≤ -->
<div class="container">
  <h2>–ê—Ä—Ö–∏–≤ –∑–∞–ø–∏—Å–µ–π</h2>
  <label>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</label>
  <input type="date" id="archiveDate" onchange="filterArchive()">
  <button onclick="prevDate()">‚¨Ö –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
  <button onclick="nextDate()">–°–ª–µ–¥—É—é—â–∞—è ‚û°</button>
  <button onclick="downloadCSV()">üì• –°–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ (Excel/CSV)</button>

  <table id="archiveTable">
    <thead>
      <tr>
        <th>–î–∞—Ç–∞</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–¶–ê</th>
        <th>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</th>
        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
        <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  let editIndex = null; // –∏–Ω–¥–µ–∫—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–ø–∏—Å–∏

  function loadData() {
    let records = JSON.parse(localStorage.getItem("records") || "[]");
    updateTables(records);
    setTodayArchive();
  }

  function saveData() {
    let eventName = document.getElementById("eventName").value;
    let targetAudience = document.getElementById("targetAudience").value;
    let growthZones = document.getElementById("growthZones").value;
    let comment = document.getElementById("comment").value;
    let participant = document.getElementById("participant").value;

    if (!eventName || !participant) {
      alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –£—á–∞—Å—Ç–Ω–∏–∫!");
      return;
    }

    let record = {
      date: new Date().toISOString().split("T")[0], // YYYY-MM-DD
      time: new Date().toLocaleTimeString(),
      eventName,
      targetAudience,
      growthZones,
      comment,
      participant
    };

    let records = JSON.parse(localStorage.getItem("records") || "[]");

    if (editIndex !== null) {
      records[editIndex] = record; // –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å
      editIndex = null;
    } else {
      records.push(record); // –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å
    }

    localStorage.setItem("records", JSON.stringify(records));
    updateTables(records);

    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById("eventName").value = "";
    document.getElementById("targetAudience").value = "";
    document.getElementById("growthZones").value = "";
    document.getElementById("comment").value = "";
    document.getElementById("participant").value = "";
  }

  function editRecord(index) {
    let records = JSON.parse(localStorage.getItem("records") || "[]");
    let r = records[index];
    document.getElementById("eventName").value = r.eventName;
    document.getElementById("targetAudience").value = r.targetAudience;
    document.getElementById("growthZones").value = r.growthZones;
    document.getElementById("comment").value = r.comment;
    document.getElementById("participant").value = r.participant;
    editIndex = index;
  }

  function deleteRecord(index) {
    let records = JSON.parse(localStorage.getItem("records") || "[]");
    records.splice(index, 1);
    localStorage.setItem("records", JSON.stringify(records));
    updateTables(records);
  }

  function updateTables(records) {
    let mainTableBody = document.querySelector("#mainTable tbody");
    let spoilerTableBody = document.querySelector("#spoilerTable tbody");
    mainTableBody.innerHTML = "";
    spoilerTableBody.innerHTML = "";

    if (records.length > 0) {
      let lastIndex = records.length - 1;
      let r = records[lastIndex];
      mainTableBody.innerHTML = rowHTML(r, lastIndex);

      for (let i = records.length - 2; i >= 0; i--) {
        spoilerTableBody.innerHTML += rowHTML(records[i], i);
      }
    }
  }

  function rowHTML(r, i) {
    return `<tr>
      <td>${r.eventName}</td>
      <td>${r.targetAudience}</td>
      <td>${r.growthZones}</td>
      <td>${r.comment}</td>
      <td>${r.participant}</td>
      <td>
        <button onclick="editRecord(${i})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button onclick="deleteRecord(${i})">–£–¥–∞–ª–∏—Ç—å</button>
      </td>
    </tr>`;
  }

  function toggleSpoiler() {
    let table = document.getElementById("spoilerTable");
    let btn = table.previousElementSibling;
    if (table.classList.contains("hidden")) {
      table.classList.remove("hidden");
      btn.textContent = "–°–∫—Ä—ã—Ç—å –∑–∞–ø–∏—Å–∏";
    } else {
      table.classList.add("hidden");
      btn.textContent = "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏";
    }
  }

  function setTodayArchive() {
    let input = document.getElementById("archiveDate");
    let today = new Date().toISOString().split("T")[0];
    input.value = today;
    filterArchive();
  }

  function filterArchive() {
    let records = JSON.parse(localStorage.getItem("records") || "[]");
    let chosenDate = document.getElementById("archiveDate").value;
    let archiveTableBody = document.querySelector("#archiveTable tbody");
    archiveTableBody.innerHTML = "";

    records.forEach(r => {
      if (r.date === chosenDate) {
        archiveTableBody.innerHTML += `<tr>
          <td>${r.date} ${r.time}</td>
          <td>${r.eventName}</td>
          <td>${r.targetAudience}</td>
          <td>${r.growthZones}</td>
          <td>${r.comment}</td>
          <td>${r.participant}</td>
        </tr>`;
      }
    });
  }

  function prevDate() {
    let input = document.getElementById("archiveDate");
    let d = new Date(input.value);
    d.setDate(d.getDate() - 1);
    input.value = d.toISOString().split("T")[0];
    filterArchive();
  }

  function nextDate() {
    let input = document.getElementById("archiveDate");
    let d = new Date(input.value);
    d.setDate(d.getDate() + 1);
    input.value = d.toISOString().split("T")[0];
    filterArchive();
  }

  function downloadCSV() {
    let records = JSON.parse(localStorage.getItem("records") || "[]");
    if (records.length === 0) {
      alert("–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç!");
      return;
    }

    let csv = "–î–∞—Ç–∞;–ù–∞–∑–≤–∞–Ω–∏–µ;–¶–ê;–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞;–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π;–£—á–∞—Å—Ç–Ω–∏–∫\n";
    records.forEach(r => {
      csv += `"${r.date} ${r.time}";"${r.eventName}";"${r.targetAudience}";"${r.growthZones}";"${r.comment}";"${r.participant}"\n`;
    });

    let BOM = "\uFEFF";
    let blob = new Blob([BOM + csv], { type: "text/csv;charset=utf-8;" });
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "archive.csv";
    link.click();
  }

  loadData();
</script>

</body>
</html>

