<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ—Å–ª—É—à–∫–∞ –∑–≤–æ–Ω–∫–æ–≤</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f7f7f7; }
    h2 { margin-top: 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; vertical-align: top; }
    th { background: #eaeaea; }
    input, textarea, select { width: 100%; padding: 6px; margin: 4px 0; }
    button { padding: 6px 12px; margin-top: 5px; cursor: pointer; }
    .container { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }

    .grid { display: flex; gap: 20px; }
    .form-section { flex: 1; }
    .table-section { flex: 2; }

    .spoiler { margin-top: 10px; }
    .spoiler button { margin-bottom: 8px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<div class="grid">
  <div class="container form-section">
    <h1>–§–æ—Ä–º–∞ –≤–Ω–µ—Å–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</h1>
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—É—á–∞—é—â–µ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</label>
    <input type="text" id="eventName">

    <label>–¶–ê:</label>
    <input type="text" id="targetAudience">

    <label>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞:</label>
    <textarea id="growthZones"></textarea>

    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
    <textarea id="comment"></textarea>

    <label>–£—á–∞—Å—Ç–Ω–∏–∫:</label>
    <input type="text" id="participant">

    <button id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>

  <div class="container table-section">
    <h2>–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h2>
    <table id="mainTable">
      <thead>
        <tr>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–¶–ê</th>
          <th>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</th>
          <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
          <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
          <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="spoiler">
      <button id="toggleSpoilerBtn">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏</button>
      <table id="spoilerTable" class="hidden">
        <thead>
          <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–¶–ê</th>
            <th>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
            <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<div class="container">
  <h2>–ê—Ä—Ö–∏–≤ –∑–∞–ø–∏—Å–µ–π</h2>
  <label>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</label>
  <input type="date" id="archiveDate">
  <button id="prevDateBtn">‚¨Ö –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
  <button id="nextDateBtn">–°–ª–µ–¥—É—é—â–∞—è ‚û°</button>
  <button id="downloadCSVBtn">üì• –°–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ (Excel/CSV)</button>

  <table id="archiveTable">
    <thead>
      <tr>
        <th>–î–∞—Ç–∞</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–¶–ê</th>
        <th>–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</th>
        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
        <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
let editIndex = null;

function loadData() {
  const records = JSON.parse(localStorage.getItem("records") || "[]");
  updateTables(records);
  setTodayArchive();
}

function saveData() {
  const eventName = document.getElementById("eventName").value.trim();
  const targetAudience = document.getElementById("targetAudience").value.trim();
  const growthZones = document.getElementById("growthZones").value.trim();
  const comment = document.getElementById("comment").value.trim();
  const participant = document.getElementById("participant").value.trim();

  if (!eventName || !participant) {
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –£—á–∞—Å—Ç–Ω–∏–∫!");
    return;
  }

  const record = {
    date: new Date().toISOString().split("T")[0],
    time: new Date().toLocaleTimeString(),
    eventName, targetAudience, growthZones, comment, participant
  };

  const records = JSON.parse(localStorage.getItem("records") || "[]");

  if (editIndex !== null) {
    records[editIndex] = record;
    editIndex = null;
  } else {
    records.push(record);
  }

  localStorage.setItem("records", JSON.stringify(records));
  updateTables(records);
  clearForm();
}

function clearForm() {
  document.getElementById("eventName").value = "";
  document.getElementById("targetAudience").value = "";
  document.getElementById("growthZones").value = "";
  document.getElementById("comment").value = "";
  document.getElementById("participant").value = "";
}

function updateTables(records) {
  const mainTableBody = document.querySelector("#mainTable tbody");
  const spoilerTableBody = document.querySelector("#spoilerTable tbody");
  mainTableBody.innerHTML = "";
  spoilerTableBody.innerHTML = "";

  if (records.length > 0) {
    const lastIndex = records.length - 1;
    mainTableBody.innerHTML = rowHTML(records[lastIndex], lastIndex);

    for (let i = records.length - 2; i >= 0; i--) {
      spoilerTableBody.innerHTML += rowHTML(records[i], i);
    }
  }
}

function rowHTML(r, i) {
  return `<tr>
    <td>${r.eventName}</td>
    <td>${r.targetAudience}</td>
    <td>${r.growthZones}</td>
    <td>${r.comment}</td>
    <td>${r.participant}</td>
    <td>
      <button class="edit-btn" data-index="${i}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="delete-btn" data-index="${i}">–£–¥–∞–ª–∏—Ç—å</button>
    </td>
  </tr>`;
}

function toggleSpoiler() {
  const table = document.getElementById("spoilerTable");
  const btn = document.getElementById("toggleSpoilerBtn");
  table.classList.toggle("hidden");
  btn.textContent = table.classList.contains("hidden") ? "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏" : "–°–∫—Ä—ã—Ç—å –∑–∞–ø–∏—Å–∏";
}

function setTodayArchive() {
  const input = document.getElementById("archiveDate");
  input.value = new Date().toISOString().split("T")[0];
  filterArchive();
}

function filterArchive() {
  const records = JSON.parse(localStorage.getItem("records") || "[]");
  const chosenDate = document.getElementById("archiveDate").value;
  const archiveTableBody = document.querySelector("#archiveTable tbody");
  archiveTableBody.innerHTML = "";

  records.forEach(r => {
    if (r.date === chosenDate) {
      archiveTableBody.innerHTML += `<tr>
        <td>${r.date} ${r.time}</td>
        <td>${r.eventName}</td>
        <td>${r.targetAudience}</td>
        <td>${r.growthZones}</td>
        <td>${r.comment}</td>
        <td>${r.participant}</td>
      </tr>`;
    }
  });
}

function changeDate(days) {
  const input = document.getElementById("archiveDate");
  const d = new Date(input.value);
  d.setDate(d.getDate() + days);
  input.value = d.toISOString().split("T")[0];
  filterArchive();
}

function downloadCSV() {
  const records = JSON.parse(localStorage.getItem("records") || "[]");
  if (records.length === 0) {
    alert("–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç!");
    return;
  }

  let csv = "–î–∞—Ç–∞;–ù–∞–∑–≤–∞–Ω–∏–µ;–¶–ê;–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞;–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π;–£—á–∞—Å—Ç–Ω–∏–∫\n";
  records.forEach(r => {
    csv += `"${r.date} ${r.time}";"${r.eventName}";"${r.targetAudience}";"${r.growthZones}";"${r.comment}";"${r.participant}"\n`;
  });

  const BOM = "\uFEFF";
  const blob = new Blob([BOM + csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "archive.csv";
  link.click();
}

// –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫
document.addEventListener("click", (e) => {
  if (e.target.matches(".edit-btn")) editRecord(e.target.dataset.index);
  if (e.target.matches(".delete-btn")) deleteRecord(e.target.dataset.index);
});

function editRecord(index) {
  const records = JSON.parse(localStorage.getItem("records") || "[]");
  const r = records[index];
  document.getElementById("eventName").value = r.eventName;
  document.getElementById("targetAudience").value = r.targetAudience;
  document.getElementById("growthZones").value = r.growthZones;
  document.getElementById("comment").value = r.comment;
  document.getElementById("participant").value = r.participant;
  editIndex = index;
}

function deleteRecord(index) {
  const records = JSON.parse(localStorage.getItem("records") || "[]");
  records.splice(index, 1);
  localStorage.setItem("records", JSON.stringify(records));
  updateTables(records);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
document.getElementById("saveBtn").addEventListener("click", saveData);
document.getElementById("toggleSpoilerBtn").addEventListener("click", toggleSpoiler);
document.getElementById("prevDateBtn").addEventListener("click", () => changeDate(-1));
document.getElementById("nextDateBtn").addEventListener("click", () => changeDate(1));
document.getElementById("downloadCSVBtn").addEventListener("click", downloadCSV);

loadData();
</script>

</body>
</html>



